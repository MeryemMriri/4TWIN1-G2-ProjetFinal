pipeline {
    agent any

    stages {
        
         stage('maven clean') {
            steps {
                sh 'mvn clean'
             
            }
        }
        stage('maven compile') {
            steps {
                sh 'mvn compile'
             
            }
        }
        stage('MVN SONARQUBE') {
            steps {
                sh 'mvn sonar:sonar -Dsonar.login=admin -Dsonar.password=mimomimi99 -Dmaven.test.skip=true';
            }
        }
        stage('NEXUS') {
            steps {
                sh 'mvn deploy';
            }
        }
        stage('Building Image') {
            steps {
                sh 'docker build -t MeriemMRIRI-4TWIN1-G2-ProjetFinal:1.0 .';
            }
        }
        stage('Push to DockerHub') {
            steps {
               script {
            // Login to DockerHub
            sh 'docker login -u meryemmriri -p mimomimi99'

            // Tag the Docker image with the desired repository and version
            sh 'docker tag MeriemMRIRI-4TWIN1-G2-ProjetFinal:1.0 meryemmriri/MeriemMRIRI-4TWIN1-G2-ProjetFinal:1.0'

            // Push the Docker image to DockerHub
            sh 'docker push meryemmriri/MeriemMRIRI-4TWIN1-G2-ProjetFinal:1.0'
        }
            }
        }
        stage('Run Docker Compose') {
            steps {
                script {
                    // Run docker-compose up command
                    sh 'docker-compose up -d'
                }
            }
        }
        stage('Graffana et Prometheus') {
            steps {
                script {
                    // Run docker-compose up command
                    sh 'docker start prometheus'
                    sh 'docker start grafana'

                }
            }
        }
        
       
      
    }
}


